"use strict";(()=>{(function(){let n="[rybbit-ad]",a=document.currentScript;if(!a){console.warn(n,"Could not find script tag");return}let u=a.getAttribute("src")||"",f=u.split("/ad.js")[0].replace("/api",""),l=a.getAttribute("data-site-id")||"";if(console.log(n,"Initialized",{siteId:l,analyticsHost:f,src:u}),!l){console.warn(n,"No data-site-id attribute found on script tag");return}let m=f+"/api/track";function g(e){let o="";try{o=new URL(e).hostname}catch{}let t={type:"ad_click",site_id:l,pathname:e,hostname:o,screenWidth:window.screen.width,screenHeight:window.screen.height,language:navigator.language,page_title:document.title,referrer:document.referrer};if(console.log(n,"Sending ad_click",t),navigator.sendBeacon){let r=navigator.sendBeacon(m,JSON.stringify(t));console.log(n,"sendBeacon result:",r)}else fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).then(r=>console.log(n,"fetch response:",r.status)).catch(r=>console.error(n,"fetch error:",r))}function p(e){if(e.src)return e.src;let o=e;for(;o;){let t=o.getAttribute("id")||"",r=o.getAttribute("data-ad-slot")||"",s=o.getAttribute("data-ad-client")||"";if(r)return`ad-slot:${r}`;if(s)return`ad-client:${s}`;if(t)return`container:${t}`;o=o.parentElement}return"unknown-ad"}document.addEventListener("click",function(e){let t=e.target.closest("a");if(!t)return;let r=t.querySelector("img");if(!r)return;let s=r.src;s&&(console.log(n,"Direct <a><img> click detected",s),g(s))});let i=null,c=null;function L(){i=this,console.debug(n,"Mouse entered iframe",this.src||"(no src)")}function E(){i===this&&(i=null)}function d(e){e.addEventListener("mouseenter",L),e.addEventListener("mouseleave",E)}function h(){let e=document.querySelectorAll("iframe");console.log(n,`Found ${e.length} iframes on page`),e.forEach(d)}new MutationObserver(function(e){for(let o of e)for(let t of Array.from(o.addedNodes))t instanceof HTMLIFrameElement&&(console.debug(n,"New iframe added",t.src||"(no src)"),d(t)),t instanceof HTMLElement&&t.querySelectorAll("iframe").forEach(d)}).observe(document.documentElement,{childList:!0,subtree:!0}),window.addEventListener("blur",function(){c&&clearTimeout(c),c=setTimeout(function(){if(i){let e=p(i);console.log(n,"Iframe click detected via blur",e),g(e),i=null}},100)}),window.addEventListener("focus",function(){c&&(clearTimeout(c),c=null)}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h()})();})();
