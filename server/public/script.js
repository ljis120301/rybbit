"use strict";(()=>{var Ie=Object.defineProperty;var Me=(n,e,t)=>e in n?Ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>Me(n,typeof e!="symbol"?e+"":e,t);function Ae(n){let e="__DOUBLE_ASTERISK_TOKEN__",t="__SINGLE_ASTERISK_TOKEN__",r=n.replace(/\*\*/g,e).replace(/\*/g,t).replace(/[.+?^${}()|[\]\\]/g,"\\$&");r=r.replace(new RegExp(`/${e}/`,"g"),"/(?:.+/)?"),r=r.replace(new RegExp(e,"g"),".*"),r=r.replace(/\//g,"\\/");let a=r.replace(new RegExp(t,"g"),"[^/]+");return new RegExp("^"+a+"$")}function x(n,e){for(let t of e)try{if(Ae(t).test(n))return t}catch(i){console.error(`Invalid pattern: ${t}`,i)}return null}function ee(n,e){let t=null;return(...i)=>{t&&clearTimeout(t),t=setTimeout(()=>n(...i),e)}}function te(n){try{let e=window.location.hostname,t=new URL(n).hostname;return t!==e&&t!==""}catch{return!1}}function m(n,e){if(!n)return e;try{let t=JSON.parse(n);return Array.isArray(e)&&!Array.isArray(t)?e:t}catch(t){return console.error("Error parsing JSON:",t),e}}async function ie(n){let e=n.getAttribute("src");if(!e)return console.error("Script src attribute is missing"),null;let t=e.split("/script.js")[0];if(!t)return console.error("Please provide a valid analytics host"),null;let i=n.getAttribute("data-site-id")||n.getAttribute("site-id");if(!i)return console.error("Please provide a valid site ID using the data-site-id attribute"),null;let r=n.getAttribute("data-namespace")||"rybbit",a=m(n.getAttribute("data-skip-patterns"),[]),c=m(n.getAttribute("data-mask-patterns"),[]),o=m(n.getAttribute("data-replay-mask-text-selectors"),[]),s=n.getAttribute("data-debounce")?Math.max(0,parseInt(n.getAttribute("data-debounce"))):500,l=n.getAttribute("data-replay-batch-size")?Math.max(1,parseInt(n.getAttribute("data-replay-batch-size"))):250,d=n.getAttribute("data-replay-batch-interval")?Math.max(1e3,parseInt(n.getAttribute("data-replay-batch-interval"))):5e3,R=n.getAttribute("data-replay-block-class")||void 0,b=n.getAttribute("data-replay-block-selector")||void 0,L=n.getAttribute("data-replay-ignore-class")||void 0,ve=n.getAttribute("data-replay-ignore-selector")||void 0,Ce=n.getAttribute("data-replay-mask-text-class")||void 0,K=n.getAttribute("data-replay-mask-all-inputs"),Re=K!==null?K!=="false":void 0,q=n.getAttribute("data-replay-mask-input-options"),we=q?m(q,{password:!0,email:!0}):void 0,G=n.getAttribute("data-replay-collect-fonts"),Te=G!==null?G!=="false":void 0,Q=n.getAttribute("data-replay-sampling"),Se=Q?m(Q,{}):void 0,Y=n.getAttribute("data-replay-slim-dom-options"),Ee=Y?m(Y,{}):void 0,X=n.getAttribute("data-replay-sample-rate"),Pe=X?Math.min(100,Math.max(0,parseInt(X,10))):void 0,u={namespace:r,analyticsHost:t,siteId:i,debounceDuration:s,sessionReplayBatchSize:l,sessionReplayBatchInterval:d,sessionReplayMaskTextSelectors:o,skipPatterns:a,maskPatterns:c,autoTrackPageview:!0,autoTrackSpa:!0,trackQuerystring:!0,trackOutbound:!0,enableWebVitals:!1,trackErrors:!1,enableSessionReplay:!1,trackButtonClicks:!1,trackRageClicks:!1,trackDeadClicks:!1,trackCopy:!1,sessionReplayBlockClass:R,sessionReplayBlockSelector:b,sessionReplayIgnoreClass:L,sessionReplayIgnoreSelector:ve,sessionReplayMaskTextClass:Ce,sessionReplayMaskAllInputs:Re,sessionReplayMaskInputOptions:we,sessionReplayCollectFonts:Te,sessionReplaySampling:Se,sessionReplaySlimDOMOptions:Ee,sessionReplaySampleRate:Pe};try{let B=`${t}/site/tracking-config/${i}`,Z=await fetch(B,{method:"GET",credentials:"omit"});if(Z.ok){let p=await Z.json();return{...u,autoTrackPageview:p.trackInitialPageView??u.autoTrackPageview,autoTrackSpa:p.trackSpaNavigation??u.autoTrackSpa,trackQuerystring:p.trackUrlParams??u.trackQuerystring,trackOutbound:p.trackOutbound??u.trackOutbound,enableWebVitals:p.webVitals??u.enableWebVitals,trackErrors:p.trackErrors??u.trackErrors,enableSessionReplay:p.sessionReplay??u.enableSessionReplay,trackButtonClicks:p.trackButtonClicks??u.trackButtonClicks,trackRageClicks:p.trackRageClicks??u.trackRageClicks,trackDeadClicks:p.trackDeadClicks??u.trackDeadClicks,trackCopy:p.trackCopy??u.trackCopy}}else return console.warn("Failed to fetch tracking config from API, using defaults"),u}catch(B){return console.warn("Error fetching tracking config:",B),u}}var re="rybbit-replay-sampled";function Le(n){if(n>=100)return!0;if(n<=0)return!1;try{let e=sessionStorage.getItem(re);if(e!==null)return e==="1";let t=Math.random()*100<n;return sessionStorage.setItem(re,t?"1":"0"),t}catch{return Math.random()*100<n}}var w=class{constructor(e,t,i){this.isRecording=!1;this.eventBuffer=[];this.config=e,this.userId=t,this.sendBatch=i}async initialize(){if(!this.config.enableSessionReplay)return;let e=this.config.sessionReplaySampleRate;e!==void 0&&!Le(e)||(window.rrweb||await this.loadRrweb(),window.rrweb&&this.startRecording())}async loadRrweb(){return new Promise((e,t)=>{let i=document.createElement("script");i.src=`${this.config.analyticsHost}/replay.js`,i.async=!1,i.onload=()=>{e()},i.onerror=()=>t(new Error("Failed to load rrweb")),document.head.appendChild(i)})}startRecording(){if(!(this.isRecording||!window.rrweb||!this.config.enableSessionReplay))try{let e={mousemove:!1,mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!0,ContextMenu:!1,DblClick:!0,Focus:!0,Blur:!0,TouchStart:!1,TouchEnd:!1},scroll:500,input:"last",media:800},t={script:!1,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},i={emit:r=>{this.addEvent({type:r.type,data:r.data,timestamp:r.timestamp||Date.now()})},recordCanvas:!1,checkoutEveryNms:6e4,checkoutEveryNth:500,blockClass:this.config.sessionReplayBlockClass??"rr-block",blockSelector:this.config.sessionReplayBlockSelector??null,ignoreClass:this.config.sessionReplayIgnoreClass??"rr-ignore",ignoreSelector:this.config.sessionReplayIgnoreSelector??null,maskTextClass:this.config.sessionReplayMaskTextClass??"rr-mask",maskAllInputs:this.config.sessionReplayMaskAllInputs??!0,maskInputOptions:this.config.sessionReplayMaskInputOptions??{password:!0,email:!0},collectFonts:this.config.sessionReplayCollectFonts??!0,sampling:this.config.sessionReplaySampling??e,slimDOMOptions:this.config.sessionReplaySlimDOMOptions??t};this.config.sessionReplayMaskTextSelectors&&this.config.sessionReplayMaskTextSelectors.length>0&&(i.maskTextSelector=this.config.sessionReplayMaskTextSelectors.join(", ")),this.stopRecordingFn=window.rrweb.record(i),this.isRecording=!0,this.setupBatchTimer()}catch{}}stopRecording(){this.isRecording&&(this.stopRecordingFn&&this.stopRecordingFn(),this.isRecording=!1,this.clearBatchTimer(),this.eventBuffer.length>0&&this.flushEvents())}isActive(){return this.isRecording}addEvent(e){this.eventBuffer.push(e),this.eventBuffer.length>=this.config.sessionReplayBatchSize&&this.flushEvents()}setupBatchTimer(){this.clearBatchTimer(),this.batchTimer=window.setInterval(()=>{this.eventBuffer.length>0&&this.flushEvents()},this.config.sessionReplayBatchInterval)}clearBatchTimer(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=void 0)}async flushEvents(){if(this.eventBuffer.length===0)return;let e=[...this.eventBuffer];this.eventBuffer=[];let t={userId:this.userId,events:e,metadata:{pageUrl:window.location.href,viewportWidth:screen.width,viewportHeight:screen.height,language:navigator.language}};try{await this.sendBatch(t)}catch{this.eventBuffer.unshift(...e)}}updateUserId(e){this.userId=e}onPageChange(){this.isRecording&&this.flushEvents()}cleanup(){this.stopRecording()}};var T=class{constructor(e){this.customUserId=null;this.config=e,this.loadUserId(),e.enableSessionReplay&&this.initializeSessionReplay()}loadUserId(){try{let e=localStorage.getItem(`${this.config.namespace}-user-id`);e&&(this.customUserId=e)}catch{}}async initializeSessionReplay(){try{this.sessionReplayRecorder=new w(this.config,this.customUserId||"",e=>this.sendSessionReplayBatch(e)),await this.sessionReplayRecorder.initialize()}catch(e){console.error("Failed to initialize session replay:",e)}}async sendSessionReplayBatch(e){try{await fetch(`${this.config.analyticsHost}/session-replay/record/${this.config.siteId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!1})}catch(t){throw console.error("Failed to send session replay batch:",t),t}}createBasePayload(){let e=new URL(window.location.href),t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),x(t,this.config.skipPatterns))return null;let i=x(t,this.config.maskPatterns);i&&(t=i);let r={site_id:this.config.siteId,hostname:e.hostname,pathname:t,querystring:this.config.trackQuerystring?e.search:"",screenWidth:screen.width,screenHeight:screen.height,language:navigator.language,page_title:document.title,referrer:document.referrer};return this.customUserId&&(r.user_id=this.customUserId),r}async sendTrackingData(e){try{await fetch(`${this.config.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0})}catch(t){console.error("Failed to send tracking data:",t)}}track(e,t="",i={}){if(e==="custom_event"&&(!t||typeof t!="string")){console.error("Event name is required and must be a string for custom events");return}let r=this.createBasePayload();if(!r)return;let c={...r,type:e,event_name:t,properties:["custom_event","outbound","error","button_click","rage_click","dead_click","copy"].includes(e)?JSON.stringify(i):void 0};this.sendTrackingData(c)}trackPageview(){this.track("pageview")}trackEvent(e,t={}){this.track("custom_event",e,t)}trackOutbound(e,t="",i="_self"){this.track("outbound","",{url:e,text:t,target:i})}trackWebVitals(e){let t=this.createBasePayload();if(!t)return;let i={...t,type:"performance",event_name:"web-vitals",...e};this.sendTrackingData(i)}trackError(e,t={}){let i=window.location.origin,r=t.filename||"",a=e.stack||"";if(r)try{if(new URL(r).origin!==i)return}catch{}else if(a&&!a.includes(i))return;let c={message:e.message?.substring(0,500)||"Unknown error",stack:a.substring(0,2e3)||""};if(r&&(c.fileName=r),t.lineno){let o=typeof t.lineno=="string"?parseInt(t.lineno,10):t.lineno;o&&o!==0&&(c.lineNumber=o)}if(t.colno){let o=typeof t.colno=="string"?parseInt(t.colno,10):t.colno;o&&o!==0&&(c.columnNumber=o)}for(let o in t)!["lineno","colno"].includes(o)&&t[o]!==void 0&&(c[o]=t[o]);this.track("error",e.name||"Error",c)}trackButtonClick(e){this.track("button_click","",e)}trackRageClick(e){this.track("rage_click","",e)}trackDeadClick(e){this.track("dead_click","",e)}trackCopy(e){this.track("copy","",e)}identify(e,t){if(typeof e!="string"||e.trim()===""){console.error("User ID must be a non-empty string");return}this.customUserId=e.trim();try{localStorage.setItem(`${this.config.namespace}-user-id`,this.customUserId)}catch{console.warn("Could not persist user ID to localStorage")}this.sendIdentifyEvent(this.customUserId,t,!0),this.sessionReplayRecorder&&this.sessionReplayRecorder.updateUserId(this.customUserId)}setTraits(e){if(!e||typeof e!="object"){console.error("Traits must be an object");return}let t=this.customUserId;if(!t){console.warn("Cannot set traits without identifying user first. Call identify() first.");return}this.sendIdentifyEvent(t,e,!1)}async sendIdentifyEvent(e,t,i=!0){try{await fetch(`${this.config.analyticsHost}/identify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_id:this.config.siteId,user_id:e,traits:t,is_new_identify:i}),mode:"cors",keepalive:!0})}catch(r){console.error("Failed to send identify event:",r)}}clearUserId(){this.customUserId=null;try{localStorage.removeItem(`${this.config.namespace}-user-id`)}catch{}}getUserId(){return this.customUserId}startSessionReplay(){this.sessionReplayRecorder?this.sessionReplayRecorder.startRecording():console.warn("Session replay not initialized")}stopSessionReplay(){this.sessionReplayRecorder&&this.sessionReplayRecorder.stopRecording()}isSessionReplayActive(){return this.sessionReplayRecorder?.isActive()??!1}onPageChange(){this.sessionReplayRecorder&&this.sessionReplayRecorder.onPageChange()}cleanup(){this.sessionReplayRecorder&&this.sessionReplayRecorder.cleanup()}};var pe=-1,k=n=>{addEventListener("pageshow",(e=>{e.persisted&&(pe=e.timeStamp,n(e))}),!0)},h=(n,e,t,i)=>{let r,a;return c=>{e.value>=0&&(c||i)&&(a=e.value-(r??0),(a||r===void 0)&&(r=e.value,e.delta=a,e.rating=((o,s)=>o>s[1]?"poor":o>s[0]?"needs-improvement":"good")(e.value,t),n(e)))}},$=n=>{requestAnimationFrame((()=>requestAnimationFrame((()=>n()))))},V=()=>{let n=performance.getEntriesByType("navigation")[0];if(n&&n.responseStart>0&&n.responseStart<performance.now())return n},v=()=>V()?.activationStart??0,g=(n,e=-1)=>{let t=V(),i="navigate";return pe>=0?i="back-forward-cache":t&&(document.prerendering||v()>0?i="prerender":document.wasDiscarded?i="restore":t.type&&(i=t.type.replace(/_/g,"-"))),{name:n,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:i}},O=new WeakMap;function z(n,e){return O.get(n)||O.set(n,new e),O.get(n)}var N=class{constructor(){f(this,"t");f(this,"i",0);f(this,"o",[])}h(e){if(e.hadRecentInput)return;let t=this.o[0],i=this.o.at(-1);this.i&&t&&i&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},C=(n,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(n)){let i=new PerformanceObserver((r=>{Promise.resolve().then((()=>{e(r.getEntries())}))}));return i.observe({type:n,buffered:!0,...t}),i}}catch{}},j=n=>{let e=!1;return()=>{e||(n(),e=!0)}},y=-1,he=new Set,ne=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,_=n=>{if(document.visibilityState==="hidden"){if(n.type==="visibilitychange")for(let e of he)e();isFinite(y)||(y=n.type==="visibilitychange"?n.timeStamp:0,removeEventListener("prerenderingchange",_,!0))}},E=()=>{if(y<0){let n=v();y=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((t=>t.name==="hidden"&&t.startTime>n))[0]?.startTime)??ne(),addEventListener("visibilitychange",_,!0),addEventListener("prerenderingchange",_,!0),k((()=>{setTimeout((()=>{y=ne()}))}))}return{get firstHiddenTime(){return y},onHidden(n){he.add(n)}}},P=n=>{document.prerendering?addEventListener("prerenderingchange",(()=>n()),!0):n()},se=[1800,3e3],J=(n,e={})=>{P((()=>{let t=E(),i,r=g("FCP"),a=C("paint",(c=>{for(let o of c)o.name==="first-contentful-paint"&&(a.disconnect(),o.startTime<t.firstHiddenTime&&(r.value=Math.max(o.startTime-v(),0),r.entries.push(o),i(!0)))}));a&&(i=h(n,r,se,e.reportAllChanges),k((c=>{r=g("FCP"),i=h(n,r,se,e.reportAllChanges),$((()=>{r.value=performance.now()-c.timeStamp,i(!0)}))})))}))},ae=[.1,.25],ge=(n,e={})=>{let t=E();J(j((()=>{let i,r=g("CLS",0),a=z(e,N),c=s=>{for(let l of s)a.h(l);a.i>r.value&&(r.value=a.i,r.entries=a.o,i())},o=C("layout-shift",c);o&&(i=h(n,r,ae,e.reportAllChanges),t.onHidden((()=>{c(o.takeRecords()),i(!0)})),k((()=>{a.i=0,r=g("CLS",0),i=h(n,r,ae,e.reportAllChanges),$((()=>i()))})),setTimeout(i))})))},fe=0,D=1/0,S=0,Be=n=>{for(let e of n)e.interactionId&&(D=Math.min(D,e.interactionId),S=Math.max(S,e.interactionId),fe=S?(S-D)/7+1:0)},U,oe=()=>U?fe:performance.interactionCount??0,xe=()=>{"interactionCount"in performance||U||(U=C("event",Be,{type:"event",buffered:!0,durationThreshold:0}))},ce=0,H=class{constructor(){f(this,"u",[]);f(this,"l",new Map);f(this,"m");f(this,"p")}v(){ce=oe(),this.u.length=0,this.l.clear()}L(){let e=Math.min(this.u.length-1,Math.floor((oe()-ce)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let t=this.u.at(-1),i=this.l.get(e.interactionId);if(i||this.u.length<10||e.duration>t.P){if(i?e.duration>i.P?(i.entries=[e],i.P=e.duration):e.duration===i.P&&e.startTime===i.entries[0].startTime&&i.entries.push(e):(i={id:e.interactionId,entries:[e],P:e.duration},this.l.set(i.id,i),this.u.push(i)),this.u.sort(((r,a)=>a.P-r.P)),this.u.length>10){let r=this.u.splice(10);for(let a of r)this.l.delete(a.id)}this.p?.(i)}}},me=n=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?n():(n=j(n),addEventListener("visibilitychange",n,{once:!0,capture:!0}),e((()=>{n(),removeEventListener("visibilitychange",n,{capture:!0})})))},le=[200,500],ye=(n,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let t=E();P((()=>{xe();let i,r=g("INP"),a=z(e,H),c=s=>{me((()=>{for(let d of s)a.h(d);let l=a.L();l&&l.P!==r.value&&(r.value=l.P,r.entries=l.entries,i())}))},o=C("event",c,{durationThreshold:e.durationThreshold??40});i=h(n,r,le,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),t.onHidden((()=>{c(o.takeRecords()),i(!0)})),k((()=>{a.v(),r=g("INP"),i=h(n,r,le,e.reportAllChanges)})))}))},F=class{constructor(){f(this,"m")}h(e){this.m?.(e)}},de=[2500,4e3],ke=(n,e={})=>{P((()=>{let t=E(),i,r=g("LCP"),a=z(e,F),c=s=>{e.reportAllChanges||(s=s.slice(-1));for(let l of s)a.h(l),l.startTime<t.firstHiddenTime&&(r.value=Math.max(l.startTime-v(),0),r.entries=[l],i())},o=C("largest-contentful-paint",c);if(o){i=h(n,r,de,e.reportAllChanges);let s=j((()=>{c(o.takeRecords()),o.disconnect(),i(!0)})),l=d=>{d.isTrusted&&(me(s),removeEventListener(d.type,l,{capture:!0}))};for(let d of["keydown","click","visibilitychange"])addEventListener(d,l,{capture:!0});k((d=>{r=g("LCP"),i=h(n,r,de,e.reportAllChanges),$((()=>{r.value=performance.now()-d.timeStamp,i(!0)}))}))}}))},ue=[800,1800],W=n=>{document.prerendering?P((()=>W(n))):document.readyState!=="complete"?addEventListener("load",(()=>W(n)),!0):setTimeout(n)},be=(n,e={})=>{let t=g("TTFB"),i=h(n,t,ue,e.reportAllChanges);W((()=>{let r=V();r&&(t.value=Math.max(r.responseStart-v(),0),t.entries=[r],i(!0),k((()=>{t=g("TTFB",0),i=h(n,t,ue,e.reportAllChanges),i(!0)})))}))};var I=class{constructor(e){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null};this.sent=!1;this.timeout=null;this.onReadyCallback=null;this.onReadyCallback=e}initialize(){try{ke(this.collectMetric.bind(this)),ge(this.collectMetric.bind(this)),ye(this.collectMetric.bind(this)),J(this.collectMetric.bind(this)),be(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendData()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendData()})}catch(e){console.warn("Error initializing web vitals tracking:",e)}}collectMetric(e){if(this.sent)return;let t=e.name.toLowerCase();this.data[t]=e.value,Object.values(this.data).every(r=>r!==null)&&this.sendData()}sendData(){this.sent||(this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onReadyCallback&&this.onReadyCallback(this.data))}getData(){return{...this.data}}};var M=class{constructor(e,t){this.clickHistory=[];this.rageClickThreshold=3;this.rageClickTimeWindow=500;this.rageClickRadiusThreshold=30;this.deadClickObserverTimeout=100;this.isProcessingClick=!1;this.tracker=e,this.config=t}initialize(){document.addEventListener("click",this.handleClick.bind(this),!0)}handleClick(e){if(this.isProcessingClick)return;this.isProcessingClick=!0;let t=e.target,i=Date.now();this.config.trackRageClicks&&this.trackRageClickIfDetected(e,i),this.config.trackButtonClicks&&this.isButton(t)&&this.trackButtonClick(t),this.config.trackDeadClicks&&!this.isInteractiveElement(t)&&this.trackDeadClickIfDetected(t),this.isProcessingClick=!1}isButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return!0;if(e.tagName==="INPUT"){let r=e.type?.toLowerCase();if(r==="submit"||r==="button")return!0}let t=e.parentElement,i=0;for(;t&&i<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return!0;t=t.parentElement,i++}return!1}isInteractiveElement(e){let t=["A","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO","AUDIO"],i=["button","link","checkbox","radio","tab","menuitem","option"];if(t.includes(e.tagName)||e.hasAttribute("onclick")||e.hasAttribute("tabindex"))return!0;let r=e.getAttribute("role");if(r&&i.includes(r)||e.style.cursor==="pointer"||window.getComputedStyle(e).cursor==="pointer")return!0;let c=e.parentElement,o=0;for(;c&&o<3;){if(t.includes(c.tagName)||c.hasAttribute("onclick"))return!0;let s=c.getAttribute("role");if(s&&i.includes(s))return!0;c=c.parentElement,o++}return!1}trackButtonClick(e){let t=this.findButton(e);if(!t)return;let i={element:t.tagName.toLowerCase(),selector:this.getSelector(t),pathname:window.location.pathname,text:this.getElementText(t),id:t.id||void 0,className:t.className||void 0};this.tracker.trackButtonClick(i)}findButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return e;if(e.tagName==="INPUT"){let r=e.type?.toLowerCase();if(r==="submit"||r==="button")return e}let t=e.parentElement,i=0;for(;t&&i<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return t;t=t.parentElement,i++}return null}trackRageClickIfDetected(e,t){let{clientX:i,clientY:r}=e;if(this.clickHistory.push({x:i,y:r,timestamp:t}),this.clickHistory=this.clickHistory.filter(a=>t-a.timestamp<=this.rageClickTimeWindow),this.clickHistory.length>=this.rageClickThreshold){let a=this.clickHistory.filter(c=>Math.sqrt(Math.pow(c.x-i,2)+Math.pow(c.y-r,2))<=this.rageClickRadiusThreshold);if(a.length>=this.rageClickThreshold){let c=e.target,o={clickCount:a.length,element:c.tagName.toLowerCase(),selector:this.getSelector(c),x:Math.round(i),y:Math.round(r),pathname:window.location.pathname};this.tracker.trackRageClick(o),this.clickHistory=[]}}}trackDeadClickIfDetected(e){let t=!1,i=new MutationObserver(()=>{t=!0});i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),setTimeout(()=>{if(i.disconnect(),!t){let r={element:e.tagName.toLowerCase(),selector:this.getSelector(e),tagName:e.tagName.toLowerCase(),pathname:window.location.pathname,text:this.getElementText(e)};this.tracker.trackDeadClick(r)}},this.deadClickObserverTimeout)}getSelector(e){if(e.id)return`#${e.id}`;let t=[],i=e,r=0;for(;i&&i!==document.body&&r<5;){let a=i.tagName.toLowerCase();if(i.id){a=`#${i.id}`,t.unshift(a);break}if(i.className){let o=i.className.split(/\s+/).filter(s=>s&&!s.includes(":")).slice(0,2);o.length>0&&(a+="."+o.join("."))}let c=i.parentElement;if(c){let o=Array.from(c.children).filter(s=>s.tagName===i.tagName);if(o.length>1){let s=o.indexOf(i)+1;a+=`:nth-child(${s})`}}t.unshift(a),i=i.parentElement,r++}return t.join(" > ").substring(0,200)}getElementText(e){return e.textContent?.trim().substring(0,100)||void 0}cleanup(){document.removeEventListener("click",this.handleClick.bind(this),!0),this.clickHistory=[]}};var A=class{constructor(e){this.tracker=e}initialize(){document.addEventListener("copy",this.handleCopy.bind(this))}handleCopy(){let e=window.getSelection();if(!e||e.isCollapsed)return;let i=e.toString().length;if(i===0)return;let r=e.anchorNode,a=r instanceof HTMLElement?r:r?.parentElement;if(!a)return;let c={textLength:i,sourceElement:a.tagName.toLowerCase(),selector:this.getSelector(a),pathname:window.location.pathname};this.tracker.trackCopy(c)}getSelector(e){if(e.id)return`#${e.id}`;let t=[],i=e,r=0;for(;i&&i!==document.body&&r<5;){let a=i.tagName.toLowerCase();if(i.id){a=`#${i.id}`,t.unshift(a);break}if(i.className){let o=i.className.split(/\s+/).filter(s=>s&&!s.includes(":")).slice(0,2);o.length>0&&(a+="."+o.join("."))}let c=i.parentElement;if(c){let o=Array.from(c.children).filter(s=>s.tagName===i.tagName);if(o.length>1){let s=o.indexOf(i)+1;a+=`:nth-child(${s})`}}t.unshift(a),i=i.parentElement,r++}return t.join(" > ").substring(0,200)}cleanup(){document.removeEventListener("copy",this.handleCopy.bind(this))}};(async function(){let n=document.currentScript;if(!n){console.error("Could not find current script tag");return}let e=n.getAttribute("data-namespace")||"rybbit",t=`disable-${e}`;if(window.__RYBBIT_OPTOUT__||localStorage.getItem(t)!==null){window[e]={pageview:()=>{},event:()=>{},error:()=>{},trackOutbound:()=>{},identify:()=>{},setTraits:()=>{},clearUserId:()=>{},getUserId:()=>null,startSessionReplay:()=>{},stopSessionReplay:()=>{},isSessionReplayActive:()=>!1};return}let i=await ie(n);if(!i)return;let r=new T(i);i.enableWebVitals&&new I(l=>{r.trackWebVitals(l)}).initialize(),(i.trackButtonClicks||i.trackRageClicks||i.trackDeadClicks)&&new M(r,i).initialize(),i.trackCopy&&new A(r).initialize(),i.trackErrors&&(window.addEventListener("error",s=>{r.trackError(s.error||new Error(s.message),{filename:s.filename,lineno:s.lineno,colno:s.colno})}),window.addEventListener("unhandledrejection",s=>{let l=s.reason instanceof Error?s.reason:new Error(String(s.reason));r.trackError(l,{type:"unhandledrejection"})}));let a=()=>r.trackPageview(),c=i.debounceDuration>0?ee(a,i.debounceDuration):a;function o(){if(document.addEventListener("click",function(s){let l=s.target;for(;l&&l!==document.documentElement;){if(l.hasAttribute("data-rybbit-event")){let d=l.getAttribute("data-rybbit-event");if(d){let R={};for(let b of l.attributes)if(b.name.startsWith("data-rybbit-prop-")){let L=b.name.replace("data-rybbit-prop-","");R[L]=b.value}r.trackEvent(d,R)}break}l=l.parentElement}if(i.trackOutbound){let d=s.target.closest("a");d?.href&&te(d.href)&&r.trackOutbound(d.href,d.innerText||d.textContent||"",d.target||"_self")}}),i.autoTrackSpa){let s=history.pushState,l=history.replaceState;history.pushState=function(...d){s.apply(this,d),c(),r.onPageChange()},history.replaceState=function(...d){l.apply(this,d),c(),r.onPageChange()},window.addEventListener("popstate",()=>{c(),r.onPageChange()}),window.addEventListener("hashchange",()=>{c(),r.onPageChange()})}}window[i.namespace]={pageview:()=>r.trackPageview(),event:(s,l={})=>r.trackEvent(s,l),error:(s,l={})=>r.trackError(s,l),trackOutbound:(s,l="",d="_self")=>r.trackOutbound(s,l,d),identify:(s,l)=>r.identify(s,l),setTraits:s=>r.setTraits(s),clearUserId:()=>r.clearUserId(),getUserId:()=>r.getUserId(),startSessionReplay:()=>r.startSessionReplay(),stopSessionReplay:()=>r.stopSessionReplay(),isSessionReplayActive:()=>r.isSessionReplayActive()},o(),window.addEventListener("beforeunload",()=>{r.cleanup()}),i.autoTrackPageview&&r.trackPageview()})();})();
